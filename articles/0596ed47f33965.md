---
title: "gRPCã®4ã¤ã®é€šä¿¡æ–¹å¼ã‚’Pythonã§ã‚„ã£ã¦ã¿ã‚‹"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["grpc", "python", "protocolbuffers"]
published: false
---
gRPCã®4ã¤ã®é€šä¿¡æ–¹å¼ã®ç†è§£ã‚’æ·±ã‚ã‚‹ãŸã‚å®Ÿéš›ã«å®Ÿè£…ã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚
æ—¢ã«Goè¨€èªã§æ›¸ã‹ã‚ŒãŸè¨˜äº‹ãŒå¤šãã‚ã£ãŸã®ã§æœ¬è¨˜äº‹ã§ã¯Pythonã§é€²ã‚ã¦ã„ãã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã¯GitHubã®[Kumamoto-Hamachi/rpc_practice](https://github.com/Kumamoto-Hamachi/rpc_practice)ã®[`zenn-article`ãƒ–ãƒ©ãƒ³ãƒ](https://github.com/Kumamoto-Hamachi/rpc_practice/tree/zenn-article)å´ã«ä»Šå›ã®è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¸Šã’ã¦ã„ã¾ã™ã€‚ã¾ãŸ`main`ãƒ–ãƒ©ãƒ³ãƒã«ã¯ç™ºå±•çš„ãªå†…å®¹ã¨ã—ã¦è¤‡æ•°ServicerãŒã‚ã‚‹å ´åˆã®ã‚³ãƒ¼ãƒ‰ã‚‚ä¸Šã’ã¦ã‚ã‚Šã¾ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å®Ÿè£…ã‚‚è¡Œã£ã¦ã„ãã¾ã™ãŒã€å®Ÿéš›ã®é–‹ç™ºã§gRPCã®å‹•ä½œç¢ºèªã‚’ã™ã‚‹éš›ã«ã¯[evans](https://github.com/ktr0731/evans)ã‚„[BloomRPC](https://github.com/bloomrpc/bloomrpc)ç­‰ã®ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã®ãŒæ¥½ãªã®ã§ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚
â€»evansã‚„BloomRPCã®è§£èª¬ã¯[gRPCã®å‹•ä½œç¢ºèªã«ã¯BloomRPCã¨evansãŒä¾¿åˆ©ï¼ã¨ã„ã†è©±](https://zenn.dev/kumamoto/articles/90e0dbddb02c9c)ã§è¡Œã£ã¦ã„ã‚‹ã®ã§ãã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ã¾ãŸgRPCã«ã¤ã„ã¦å…¨ãèã„ãŸã“ã¨ã‚‚ãªã„ã¨ã„ã†ãƒ¬ãƒ™ãƒ«ã®æ–¹ã¯ã¾ãšã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã•ã‚“ã®å‡ºã•ã‚Œã¦ã„ã‚‹[ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã®ãŸã‚ã®æ–°æŠ€è¡“ã€ŒgRPCã€å…¥é–€](https://knowledge.sakura.ad.jp/24059/)ãŒéå¸¸ã«åˆ†ã‹ã‚Šã‚„ã™ã„ã®ã§ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚(æœ¬è¨˜äº‹ã®Unary RPCã®å®Ÿè£…ã§ã‚‚å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ã¦ã„ã¾ã™ã€‚)

# å‰æ

## gRPCã¨ã¯ãªã«ã‹

![](https://storage.googleapis.com/zenn-user-upload/60635e28ccc7-20221108.png)

>  a client application can directly call a method on a server application on a different machine as if it were a local object, making it easier for you to create distributed applications and services. 
gRPC is based around the idea of defining a service, specifying the methods that can be called remotely with their parameters and return types. 

â€»[Introduction to gRPC | gRPC](https://grpc.io/docs/what-is-grpc/introduction/)ã‚ˆã‚Š

gRPCã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã‚³ãƒ¼ãƒ«(RPC)ã‚·ã‚¹ãƒ†ãƒ ã®1ã¤ã€‚RPCã¨ã¯é éš”æ‰‹ç¶šãå‘¼å‡ºã—ã®ã“ã¨ã§ç°¡å˜ã«è¨€ãˆã°ã€Œé•ã†ã‚µãƒ¼ãƒãƒ¼ã«ã‚ã‚‹é–¢æ•°ã‚’å®Ÿè¡Œã•ã›ã‚‹ä»•çµ„ã¿ã€ã®ã“ã¨ã§ã€å‘¼ã³å‡ºã™å´(ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)ã¨å‘¼ã³å‡ºã•ã‚Œã‚‹å´(ã‚µãƒ¼ãƒãƒ¼)ã«åˆ¥ã‚Œã¦ã„ã‚‹[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ-ã‚µãƒ¼ãƒãƒ¼ãƒ¢ãƒ‡ãƒ«](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%83%BC%E3%83%90%E3%83%A2%E3%83%87%E3%83%AB)æ–¹å¼ã‚’å–ã£ã¦ã„ã¾ã™ã€‚


> On the client side, the client has a stub (referred to as just a client in some languages) that provides the same methods as the server.
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚µãƒ¼ãƒãƒ¼å´ã¨åŒã˜ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ã‚¹ã‚¿ãƒ–ã‚’æŒã£ã¦ã„ã‚‹ã€‚

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚µãƒ¼ãƒãƒ¼å´ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™éš›ã«ä½¿ã†ã‚¹ã‚¿ãƒ–^[ITã®åˆ†é‡ã§ã¯ã€æœ¬ç‰©ãŒç”¨æ„ã§ããªã„ã¨ãã«å‹•ä½œã«æ”¯éšœãŒç„¡ã„ã‚ˆã†ã«ã¨ã‚Šã‚ãˆãšç½®ã„ã¦ãŠãä»£ç”¨å“ã¨ã„ã†æ„å‘³ã§ä½¿ã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã‚ˆã†ã§ã™ã€‚]ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã£ã¦ã„ã¾ã™ã€‚


## Protocol Buffersã¨ã¯ãªã«ã‹
gRPCã¯Protocol Buffersã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã—ã¦ã„ã¾ã™ã€‚^[jsonã‚’ä»£æ›¿ã¨ã—ã¦ä½¿ã†ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚]

>Protocol buffers provide a language-neutral, platform-neutral, extensible mechanism for serializing structured data in a forward-compatible and backward-compatible way. Itâ€™s like JSON, except it's smaller and faster, and it generates native language bindings.
Protocol buffers are a combination of the definition language (created in .proto files), the code that the proto compiler generates to interface with data, language-specific runtime libraries, and the serialization format for data that is written to a file (or sent across a network connection).

Protocol Buffersã¨ã¯IDL(Interface Definition Language/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©è¨€èª)ã§ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’å®šç¾©ã™ã‚‹ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã®ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šçš„ã«ä¿å­˜ã—ãŸã‚Šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ã§ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹éš›ã«ä½¿ã‚ã‚Œã¾ã™ã€‚

é›£ã—ãæ›¸ãã¾ã—ãŸãŒè¦ã¯ãƒ‡ãƒ¼ã‚¿ãŒã©ã‚“ãªå‹ã‚’æŒã£ã¦ã„ã‚‹ã‹ã€ã©ã†ã„ã†æ§‹é€ ã‚’ã—ã¦ã„ã‚‹ã®ã‹ç°¡å˜ã«æ›¸ãè¡¨ã›ã‚‹è¨€èªã ã¨ã„ã†ã“ã¨ã§ã™ã€‚

å¾Œã€…å…·ä½“ä¾‹ã§Protocol Buffersã‚’æ›¸ã„ã¦ã„ãã¾ã™ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚„ã‚Šå–ã‚Šã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ãƒ»è¿”ã‚Šå€¤ã®å‹ã‚’å®šç¾©ã—ã¦ã„ãã®ã«ç”¨ã„ã¾ã™ã€‚

```
// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‹æ§‹é€ ã®ã‚¤ãƒ¡ãƒ¼ã‚¸(enumã¨ã‹mapã¨ã‹ä¾¿åˆ©ãªã®ã‚‚ã‚ã‚‹ã‚ˆ)
message ï¼œå®šç¾©ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹ã®åå‰ï¼ {
  ï¼œå‹ï¼ ï¼œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å1ï¼ = ï¼œãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç´ã¥ã‘ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç•ªå·ï¼;
  ï¼œå‹ï¼ ï¼œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å2ï¼ = ï¼œãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç´ã¥ã‘ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç•ªå·ï¼;
  ï¼œå‹ï¼ ï¼œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å3ï¼ = ï¼œãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç´ã¥ã‘ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç•ªå·ï¼;
  ï¼š
  ï¼š
}
```



# 4ã¤ã®é€šä¿¡æ–¹å¼
unaryã¨streamingã®2ç¨®é¡ãŒã‚ã‚Šãã‚Œã‚’clientã¨serverãã‚Œãã‚ŒãŒã©ã¡ã‚‰ã‚’é¸æŠã™ã‚‹ã‹ã€ã¤ã¾ã‚Š$2*2=4$é€šã‚Šã®é€šä¿¡æ–¹å¼ãŒã‚ã‚Šã¾ã™ã€‚

## 0. å‰æã¨ãªã‚‹æ§‹æˆã¨å®Ÿè£…

ä»Šå›ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã§é€²ã‚ã¦ã„ãã¾ã™ã€‚

```bash
$ cd ~
$ tree
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ grpc
â”‚Â Â  â”œâ”€â”€ client
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.py
â”‚Â Â  â”œâ”€â”€ grpc_client.py
â”‚Â Â  â”œâ”€â”€ grpc_manager.py
â”‚Â Â  â”œâ”€â”€ json_data
â”‚Â Â  â”‚Â Â  â””â”€â”€ users.json
â”‚Â Â  â”œâ”€â”€ proto.bash
â”‚Â Â  â”œâ”€â”€ protos
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.proto
â”‚Â Â  â”œâ”€â”€ servicers
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.py
â”‚Â Â  â”œâ”€â”€ user_pb2.py
â”‚Â Â  â””â”€â”€ user_pb2_grpc.py
â”œâ”€â”€ poetry.lock
â””â”€â”€ pyproject.toml
```

ã¾ãŸDBã®ç°¡æ˜“çš„ãªä»£æ›¿ã¨ã—ã¦jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

:::details ~/json_data/users.json
```json
{
	"1": {
		"id": 1,
		"nickname": "admin",
		"mail_address": "admin@example.com",
		"user_type": "ADMINISTRATOR"
	},
	"2": {
		"id": 2,
		"nickname": "guest",
		"mail_address": "guest@example.com",
		"user_type": "GUEST"
	},
	"3": {
		"id": 3,
		"nickname": "foo",
		"mail_address": "foo@example.com",
		"user_type": "NORMAL"
	},
	"4": {
		"id": 4,
		"nickname": "troll",
		"mail_address": "troll@example.com",
		"user_type": "DISABLED"
	},
	"5": {
		"id": 5,
		"nickname": "Zaru",
		"mail_address": "zaru@example.com",
		"user_type": "NORMAL"
	},
	"6": {
		"id": 6,
		"nickname": "Saru",
		"mail_address": "saru@example.com",
		"user_type": "NORMAL"
	}
}
```
:::

ã‚µãƒ¼ãƒ“ã‚µãƒ¼ã‚’ç™»éŒ²ãƒ»å‹•ä½œã•ã›ã‚‹çµ±å¾¡ç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè£…ã—ã¾ã™ã€‚
â€»gRPCãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³äº‘ã€…ã¨ã‚ã‚‹ç®‡æ‰€ã«ã¤ã„ã¦ã¯åˆå¿ƒè€…ã®æ–¹ã¯æ°—ã«ã›ãšã§å¤§ä¸ˆå¤«ã§ã™ã€‚

:::details ~/grpc/grpc_manager.py
```
# gRPC serverã«ç™»éŒ²ã™ã‚‹servicer
from servicers.user import UserManager
# gRPCã®ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ã§ã¯ThreadPoolã‚’åˆ©ç”¨ã™ã‚‹
from concurrent.futures import ThreadPoolExecutor

# ã€Œgrpcã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã€grpc_tools.protocã«ã‚ˆã£ã¦ç”Ÿæˆã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’importã™ã‚‹
import grpc
import user_pb2
import user_pb2_grpc

# grpc reflectionç”¨ã®è¿½åŠ ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
from grpc_reflection.v1alpha import reflection


def manager():
    # Serverã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹
    server = grpc.server(ThreadPoolExecutor(max_workers=2))

    # Serverã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å®šç¾©ã—ãŸServicerã‚¯ãƒ©ã‚¹ã‚’ç™»éŒ²ã™ã‚‹
    user_pb2_grpc.add_UserManagerServicer_to_server(UserManager(), server)

    # [è¿½è¨˜] ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç™»éŒ²
    SERVICE_NAMES = (
        reflection.SERVICE_NAME,
    )
    SERVICE_NAMES += (user_pb2.DESCRIPTOR.services_by_name[UserManager.__name__].full_name,)
    reflection.enable_server_reflection(SERVICE_NAMES, server)

    # 1234ç•ªãƒãƒ¼ãƒˆã§å¾…ã¡å—ã‘ã™ã‚‹ã‚ˆã†æŒ‡å®šã™ã‚‹
    server.add_insecure_port("[::]:1234")

    # å¾…ã¡å—ã‘ã‚’é–‹å§‹ã™ã‚‹
    server.start()

    # å¾…ã¡å—ã‘çµ‚äº†å¾Œã®å¾Œå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
    server.wait_for_termination()

if __name__ == "__main__":
    manager()
```
:::

ã‚µãƒ¼ãƒ“ã‚µãƒ¼ã‚’å©ãã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ä¸‹æº–å‚™ã‚‚è¡Œã£ã¦ã„ãã¾ã™ã€‚
â€»å®Ÿéš›ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã—ã¦ãã¾ã™ã€‚

:::details ~/grpc/grpc_client.py
```
from typing import List
from pprint import pprint
import sys

# ã€Œgrpcã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã€protocã«ã‚ˆã£ã¦ç”Ÿæˆã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’importã™ã‚‹
import grpc
import user_pb2
import user_pb2_grpc


def main():
    # ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã™ã‚‹
    channel = grpc.insecure_channel("localhost:1234")
    # é€ä¿¡å…ˆã®ã€Œstubã€ã‚’ä½œæˆã™ã‚‹
    stub = user_pb2_grpc.UserManagerStub(channel)
    # ãã‚Œãã‚Œã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹
    if sys.argv[1] == "GetUser":
        res = get_user(stub=stub, user_id=int(sys.argv[2]))
    elif sys.argv[1] == "AddUser":
        res = add_user(
            stub=stub,
            user_id=int(sys.argv[2]),
            nickname=sys.argv[3],
            mail_address=sys.argv[4],
            user_type=int(sys.argv[5]),
        )
    elif sys.argv[1] == "CountAlreadyUsers":
        user_id_list = [int(sys.argv[2]), int(sys.argv[3])]
        res = count_already_users(stub=stub, user_id_list=user_id_list)
    elif sys.argv[1] == "GetUsersByType":
        res = get_users_by_type(stub=stub, user_type=int(sys.argv[2]))
    elif sys.argv[1] == "GetUsersByIds":
        user_id_list = [int(sys.argv[2]), int(sys.argv[3])]
        res = get_users_by_ids(stub=stub, user_id_list=user_id_list)
    return res


if __name__ == "__main__":
    main()
```
:::

protoãƒ•ã‚¡ã‚¤ãƒ«å†…ã§messageã‚„serviceã®å®šç¾©ã‚‚è¡Œã„ã¾ã™ã€‚

:::details ~/grpc/protos/user.proto
```
syntax = "proto3";

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¡¨ã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹
message User {
  uint32 id = 1;
  string nickname = 2;
  string mail_address = 3;
  enum UserType {
    NONE = 0;
    NORMAL = 1;
    ADMINISTRATOR = 2;
    GUEST = 3;
    DISABLED = 4;
  }
  UserType user_type = 4;
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹
message UserRequest {
  uint32 id = 1;
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹
message UserTypeRequest {
  enum UserType {
    NONE = 0;
    NORMAL = 1;
    ADMINISTRATOR = 2;
    GUEST = 3;
    DISABLED = 4;
  }
  UserType user_type = 4;
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”ã™éš›ã«ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹
message UserResponse {
  bool error = 1;
  string message = 2;
  User user = 3;
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼äººæ•°ã‚’è¿”ã™éš›ã«ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹
message UserCntResponse {
  bool error = 1;
  uint32 user_cnt = 2;
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚’è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹
service UserManager {
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹
  rpc GetUser (UserRequest) returns (UserResponse) {}
  // æ–°è¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿½åŠ ã™ã‚‹
  rpc AddUser (User) returns (UserResponse) {}
  // ä¸ãˆã‚‰ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã†ã¡å­˜åœ¨ã™ã‚‹äººæ•°ã‚’å–å¾—ã™ã‚‹
  rpc CountAlreadyUsers (stream UserRequest) returns (UserCntResponse) {}
  // ä¸ãˆã‚‰ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—ã¨åŒç¨®ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã™ã‚‹
  rpc GetUsersByType (UserTypeRequest) returns (stream UserResponse) {}
  rpc GetUsersByIds (stream UserRequest) returns (stream UserResponse) {}
}
```
:::

ä¸Šè¨˜ã®protoãƒ•ã‚¡ã‚¤ãƒ«ã‚’`protoc`ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ã§messageãŒè¨˜è¿°ã•ã‚Œã‚‹`user_pb2.py`ã€serviceãŒè¨˜è¿°ã•ã‚Œã‚‹`user._pb2_grpc.py`ã‚’ç”Ÿæˆã™ã‚‹ã€‚

```
$ python -m grpc_tools.protoc -I./protos --python_out=. --grpc_python_out=. ./protos/user.proto
```

æœ€å¾Œã®ä¸‹æº–å‚™ã¨ã—ã¦ã‚µãƒ¼ãƒ“ã‚µãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å…¥ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```
from google.protobuf import json_format
from typing import List
from collections.abc import Iterable
import json


# ã€Œgrpcã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã€grpc_tools.protocã«ã‚ˆã£ã¦ç”Ÿæˆã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’importã™ã‚‹
import user_pb2
import user_pb2_grpc


# ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®èª­ã¿è¾¼ã¿
USER_DB = "./json_data/users.json"
with open(USER_DB, mode="r") as fp:
    users = json.load(fp)


class UserManager(user_pb2_grpc.UserManagerServicer):
    """
    ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ã¦ã€
    å®šç¾©ã—ãŸãƒªãƒ¢ãƒ¼ãƒˆãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã«å¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚
    ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå¼•æ•°ã¨ã—ã¦ä¸ãˆãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¯¾å¿œã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    contextå¼•æ•°ã«ã¯RPCã«é–¢ã™ã‚‹æƒ…å ±ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ¸¡ã•ã‚Œã‚‹
    """

    #ã“ã®ä¸‹ã«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ã
```

## 1. Unary RPC(Simple RPC)
![](https://storage.googleapis.com/zenn-user-upload/6e7732b80be9-20221124.png)
clientã€serverå…±ã«unary(å˜ä¸€)ã®é€šä¿¡æ–¹å¼ã€‚

ã“ã“ã§ã¯userã®å–å¾—ã‚’è¡Œã†`GetUser`ã¨userã®è¿½åŠ ã‚’è¡Œã†`AddUser`ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

:::details ~/grpc/servicers/user.pyã®GetUser
```py
class UserManager(user_pb2_grpc.UserManagerServicer):

    def GetUser(self, request: user_pb2.UserRequest, context):
        """
        Unary RPC(Simple RPC)
        ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹
        """
        # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒé€ä¿¡ã—ãŸå¼•æ•°ã¯requestå¼•æ•°ã«æ ¼ç´ã•ã‚Œã€
        # ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã¯ä¸€èˆ¬çš„ãªPythonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨
        # åŒæ§˜ã®å½¢ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
        user_id = request.id

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã—ãŸã‚‚ã®ã‚’ã‚­ãƒ¼ã¨ã™ã‚‹è¾æ›¸å‹ãƒ‡ãƒ¼ã‚¿
        if str(user_id) not in users:
            # è©²å½“ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
            return user_pb2.UserResponse(error=True, message="not found")
        user = users[str(user_id)]

        # æˆ»ã‚Šå€¤ã¨ã—ã¦è¿”ã™Userã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹
        result = user_pb2.User(
            id=user["id"],
            nickname=user["nickname"],
            mail_address=user["mail_address"],
            user_type=user_pb2.User.UserType.Value(user["user_type"]),
        )
        print("result.user_type", result.user_type, type(result.user_type))  # debug

        # UserResponseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™
        return user_pb2.UserResponse(error=False, user=result)
```
:::

:::details ~/grpc/servicers/user.pyã®AddUser
```py
class UserManager(user_pb2_grpc.UserManagerServicer):

    def AddUser(self, request: user_pb2.User, context):
        """
        Unary RPC(Simple RPC)
        æ–°è¦ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹
        """
        # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒé€ä¿¡ã—ãŸå¼•æ•°ã¯requestå¼•æ•°ã«æ ¼ç´ã•ã‚Œã€
        # ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã¯ä¸€èˆ¬çš„ãªPythonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨
        # åŒæ§˜ã®å½¢ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
        user_id = request.id

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã—ãŸã‚‚ã®ã‚’ã‚­ãƒ¼ã¨ã™ã‚‹è¾æ›¸å‹ãƒ‡ãƒ¼ã‚¿
        # ãªã®ã§ã€é©å®œæ–‡å­—åˆ—å‹ã«å¤‰æ›ã—ã¦ä½¿ç”¨ã—ã¦ã„ã‚‹
        if str(user_id) in users:
            # è©²å½“ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¢ã«å­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
            return user_pb2.UserResponse(error=True, message="already exist")

        # æ–°è¦ç™»éŒ²ç”¨åŠã³æˆ»ã‚Šå€¤ã¨ã—ã¦è¿”ã™Userã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹
        result = user_pb2.User(
            id=request.id,
            nickname=request.nickname,
            mail_address=request.mail_address,
            user_type=request.user_type,
        )
        # preserving_proto_field_nameã§camelCaseãŒsnake_caseã«å¤‰æ›ã•ã‚Œã‚‹
        users[str(request.id)] = json_format.MessageToDict(
            result, preserving_proto_field_name=True
        )
        with open(USER_DB, mode="w") as f:
            json.dump(users, f)

        # UserResponseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™
        return user_pb2.UserResponse(error=False, user=result)
```
:::

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯ãã‚Œãã‚Œä¸‹è¨˜ã®ã‚ˆã†ãªå®Ÿè£…ã§ã™ã€‚

:::  ~/grpc/grpc_clientã®get_user
```py
def get_user(stub, user_id: int):
    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä½¿ç”¨ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã“ã“ã§ã¯ã€ŒUserRequestã€å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’ä½œæˆ
    req = user_pb2.UserRequest(id=user_id)
    response = stub.GetUser(req)
    # å–å¾—ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¡¨ç¤º
    pprint(response)
    return response
```

:::  ~/grpc/grpc_clientã®add_user
```py
def add_user(stub, user_id: int, nickname: str, mail_address: str, user_type: int):
    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä½¿ç”¨ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã“ã“ã§ã¯ã€ŒUserã€å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’ä½œæˆ
    req = user_pb2.User(
        id=user_id, nickname=nickname, mail_address=mail_address, user_type=user_type
    )
    response = stub.AddUser(req)
    # å–å¾—ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¡¨ç¤º
    pprint(response)
    return response
```


## 2. Server streaming RPC(Response Streaming RPC)
![](https://storage.googleapis.com/zenn-user-upload/39b2cebfd6e0-20221124.png)

Server streaming RPCã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®æŠ•ã’ã¦ãã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯Unary(å˜ä¸€)ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹å´ãŒè¤‡æ•°(Streaming)ã®é€šä¿¡æ–¹å¼ã€‚

ã“ã“ã§ã¯æ¸¡ã•ã‚ŒãŸtypeã¨åŒä¸€ã®userã‚’å…¨ã¦ã‚’å–å¾—ã—ãŸä¸Šã§ãã®user1ã¤1ã¤ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«è©°ã‚ã¦æŠ•ã’ã‚‹`GetUsersByType`ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

:::details ~/grpc/servicers/user.pyã®GetUsersByType
```
class UserManager(user_pb2_grpc.UserManagerServicer):

    def GetUsersByType(self, request: user_pb2.UserTypeRequest, context):
        """
        Server streaming RPC(Response-streaming RPC)
        æ¸¡ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—ã¨åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¤‡æ•°è¿”ã™
        """
        user_id_list = [u for u in users]
        print("user_id_list", user_id_list)  # debug
        result_list = []
        for u_id in user_id_list:
            user = users[u_id]
            # Name(æ•°å­—), Value(NORMAL)ã¨ã‹
            if user_pb2.User.UserType.Name(request.user_type) == user["user_type"]:
                print(f"{user['id']}---è©²å½“ã‚ã‚Š---")
                result = user_pb2.User(
                    id=user["id"],
                    nickname=user["nickname"],
                    mail_address=user["mail_address"],
                    user_type=user_pb2.User.UserType.Value(user["user_type"]),
                )
                yield user_pb2.UserResponse(error=False, user=result)
        # ä½•ã‚‚è¿”ã•ãªã„æ¡ä»¶ãŒæ¥ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„
```
:::

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å®Ÿè£…ã¯ä¸‹è¨˜ã§ã™ã€‚

:::details ~/grpc/grpc_clientã®get_users_by_type
```py
def get_users_by_type(stub, user_type: int):
    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä½¿ç”¨ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã“ã“ã§ã¯ã€ŒUserTypeRequestã€å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’ä½œæˆ
    req = user_pb2.UserTypeRequest(user_type=user_type)
    responses = stub.GetUsersByType(req)
    response_list = []
    for r in responses:
        # å–å¾—ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¡¨ç¤º
        pprint(r)  # debug
        response_list.append(r)
    return response_list
```
:::

## 3. Client streaming RPC(Request Streaming RPC)
![](https://storage.googleapis.com/zenn-user-upload/32f991bd991d-20221124.png)

Client streaming RPCã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®æŠ•ã’ã¦ãã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¤‡æ•°(Streaming)ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒUnary(å˜ä¸€)ã®é€šä¿¡æ–¹å¼ã€‚

ã“ã“ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼id1ã¤ãŒå…¥ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¤‡æ•°æŠ•ã’ã‚‰ã‚Œã¦ãã‚‹ã®ã§ã€users.jsonã«å­˜åœ¨ã™ã‚‹userã®æŒã¤idã¨æ¯”è¼ƒã—ã¦å­˜åœ¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼idã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦è¿”ã™`CountAlreadyUsers`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚

:::details ~/grpc/servicers/user.pyã®CountAlreadyUsers
```py
    def CountAlreadyUsers(self, request_iter: Iterable[user_pb2.UserRequest], context):
        """
        Client streaming RPC(Request-streaming RPC)
        è¤‡æ•°æ¸¡ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼idã®ã†ã¡æ—¢ã«å­˜åœ¨ã—ã¦ã„ã‚‹äººæ•°ã‚’å–å¾—ã™ã‚‹
        """
        user_cnt = 0
        for request in request_iter:
            user_id = request.id
            # ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã—ãŸã‚‚ã®ã‚’ã‚­ãƒ¼ã¨ã™ã‚‹è¾æ›¸å‹ãƒ‡ãƒ¼ã‚¿
            if str(user_id) in users:
                # è©²å½“ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ãªã‚‰ã‚«ã‚¦ãƒ³ãƒˆ
                user_cnt += 1
```
:::

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å®Ÿè£…ã¯ä¸‹è¨˜ã§ã™ã€‚

:::details ~/grpc/grpc_clientã®count_already_users
```py
def count_already_users(stub, user_id_list: List[int]):
    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä½¿ç”¨ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã“ã“ã§ã¯ã€ŒUserRequestã€å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’è¤‡æ•°ä½œæˆ
    req_list = []
    for user_id in user_id_list:
        req = user_pb2.UserRequest(id=user_id)
        req_list.append(req)
    response = stub.CountAlreadyUsers(iter(req_list))
    # å–å¾—ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¡¨ç¤º
    pprint(response)
    return response
```
:::


## 4. Bidirectional streaming RPC
![](https://storage.googleapis.com/zenn-user-upload/b3849e37e9c3-20221124.png)

Bidirectional streaming RPCã¯Bidirectional(åŒæ–¹å‘)ã¨ã„ã†èªã®é€šã‚Šã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚ä¸¡æ–¹è¤‡æ•°(Streaming)ã®é€šä¿¡æ–¹å¼ã€‚

ä¸Šè¨˜ã®å›³ã§ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ãã£ã¦ã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™æ§˜ã«ãªã£ã¦ã„ã‚‹ãŒã€ãƒ”ãƒ³ãƒãƒ³ã®ã‚ˆã†ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’1ã¤å—ã‘ã‚‹ã”ã¨ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’1ã¤è¿”ã™ã¨ã„ã†æ–¹å¼ã§ã®å®Ÿè£…ã§ã‚‚å•é¡Œãªã„ã€‚

ä»Šå›ã¯ãƒ”ãƒ³ãƒãƒ³æ–¹å¼ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ä¸ãˆã‚‰ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼idã¨åˆè‡´ã™ã‚‹idã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã™`GetUsersByIds`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚

:::details ~/grpc/servicers/user.pyã®GetUsersByIds
```
    def GetUsersByIds(self, request_iter: Iterable[user_pb2.UserRequest], context):
        """
        Bidrectional streaming RPC
        è¤‡æ•°æ¸¡ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼idã®ã†ã¡å­˜åœ¨ã—ã¦ã„ã‚‹Userã‚’è¿”ã™
        """
        user_list = []
        for request in request_iter:
            user_id = request.id
            # ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã—ãŸã‚‚ã®ã‚’ã‚­ãƒ¼ã¨ã™ã‚‹è¾æ›¸å‹ãƒ‡ãƒ¼ã‚¿
            if str(user_id) in users:
                user = users[str(user_id)]
                user_list.append(user)
        for user in user_list:
            result = user_pb2.User(
                id=user["id"],
                nickname=user["nickname"],
                mail_address=user["mail_address"],
                user_type=user_pb2.User.UserType.Value(user["user_type"]),
            )
            yield user_pb2.UserResponse(error=False, user=result)
```
:::

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å®Ÿè£…ã¯ä¸‹è¨˜ã§ã™ã€‚

:::details ~/grpc/grpc_clientã®get_users_by_ids
```py
def get_users_by_ids(stub, user_id_list: List[int]):
    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä½¿ç”¨ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã“ã“ã§ã¯ã€ŒUserRequestã€å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’è¤‡æ•°ä½œæˆ
    req_list = []
    for user_id in user_id_list:
        req = user_pb2.UserRequest(id=user_id)
        req_list.append(req)
    responses = stub.GetUsersByIds(iter(req_list))
    response_list = []
    for r in responses:
        # å–å¾—ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¡¨ç¤º
        pprint(r)  # debug
        response_list.append(r)
    return response_list
```
:::




# å‚è€ƒ
https://grpc.io/docs/what-is-grpc/core-concepts/

https://developers.google.com/protocol-buffers/docs/overview

https://knowledge.sakura.ad.jp/24059/
